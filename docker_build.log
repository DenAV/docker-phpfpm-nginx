Sending build context to Docker daemon  22.02kB
Step 1/27 : FROM alpine:3.11
3.11: Pulling from library/alpine
79e9f2f55bf5: Already exists
Digest: sha256:bcae378eacedab83da66079d9366c8f5df542d7ed9ab23bf487e3e1a8481375d
Status: Downloaded newer image for alpine:3.11
 ---> a787cb986503
Step 2/27 : ADD https://packages.whatwedo.ch/php-alpine.rsa.pub /etc/apk/keys/php-alpine.rsa.pub


 ---> e5f228f43828
Step 3/27 : RUN apk --update add ca-certificates
 ---> Running in 6eb285c99dda
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/community/x86_64/APKINDEX.tar.gz
(1/1) Installing ca-certificates (20191127-r2)
Executing busybox-1.31.1-r11.trigger
Executing ca-certificates-20191127-r2.trigger
OK: 6 MiB in 15 packages
Removing intermediate container 6eb285c99dda
 ---> 73dbd54fb856
Step 4/27 : RUN echo "https://packages.whatwedo.ch/php-alpine/v3.11/php-7.4" >> /etc/apk/repositories
 ---> Running in 736ac805a24d
Removing intermediate container 736ac805a24d
 ---> 4444a87d06ad
Step 5/27 : RUN apk --no-cache add php php-fpm php-opcache php-openssl php-curl     nginx supervisor curl
 ---> Running in 30d7dd283dd0
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/community/x86_64/APKINDEX.tar.gz
fetch https://packages.whatwedo.ch/php-alpine/v3.11/php-7.4/x86_64/APKINDEX.tar.gz
(1/28) Installing nghttp2-libs (1.40.0-r1)
(2/28) Installing libcurl (7.79.1-r0)
(3/28) Installing curl (7.79.1-r0)
(4/28) Installing pcre (8.43-r1)
(5/28) Installing nginx (1.16.1-r8)
Executing nginx-1.16.1-r8.pre-install
(6/28) Installing php7-common (7.4.26-r1)
(7/28) Installing argon2-libs (20190702-r1)
(8/28) Installing ncurses-terminfo-base (6.1_p20200118-r4)
(9/28) Installing ncurses-libs (6.1_p20200118-r4)
(10/28) Installing libedit (20191211.3.1-r0)
(11/28) Installing pcre2 (10.34-r1)
(12/28) Installing xz-libs (5.2.4-r0)
(13/28) Installing libxml2 (2.9.12-r0)
(14/28) Installing php7 (7.4.26-r1)
(15/28) Installing php7-curl (7.4.26-r1)
(16/28) Installing php7-fpm (7.4.26-r1)
(17/28) Installing php7-opcache (7.4.26-r1)
(18/28) Installing php7-openssl (7.4.26-r1)
(19/28) Installing libbz2 (1.0.8-r1)
(20/28) Installing expat (2.2.9-r1)
(21/28) Installing libffi (3.2.1-r6)
(22/28) Installing gdbm (1.13-r1)
(23/28) Installing readline (8.0.1-r0)
(24/28) Installing sqlite-libs (3.30.1-r2)
(25/28) Installing python3 (3.8.10-r0)
(26/28) Installing py3-meld3 (2.0.0-r1)
(27/28) Installing py3-setuptools (42.0.2-r0)
(28/28) Installing supervisor (4.1.0-r0)
Executing busybox-1.31.1-r11.trigger
OK: 111 MiB in 43 packages
Removing intermediate container 30d7dd283dd0
 ---> 5da6dffcf20c
Step 6/27 : RUN apk add --no-cache openrc
 ---> Running in b4c3a83f3c73
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/community/x86_64/APKINDEX.tar.gz
fetch https://packages.whatwedo.ch/php-alpine/v3.11/php-7.4/x86_64/APKINDEX.tar.gz
(1/1) Installing openrc (0.42.1-r3)
Executing openrc-0.42.1-r3.post-install
Executing busybox-1.31.1-r11.trigger
OK: 114 MiB in 44 packages
Removing intermediate container b4c3a83f3c73
 ---> 388817a8e1b8
Step 7/27 : RUN apk add --no-cache --update python3 && ln -sf python3 /usr/bin/python
 ---> Running in da647aebca26
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz
fetch http://dl-cdn.alpinelinux.org/alpine/v3.11/community/x86_64/APKINDEX.tar.gz
fetch https://packages.whatwedo.ch/php-alpine/v3.11/php-7.4/x86_64/APKINDEX.tar.gz
OK: 114 MiB in 44 packages
Removing intermediate container da647aebca26
 ---> bc9cbafc1775
Step 8/27 : RUN python3 -m ensurepip
 ---> Running in c95be8e15e61
Looking in links: /tmp/tmpa9gar2jo
Requirement already satisfied: setuptools in /usr/lib/python3.8/site-packages (56.0.0)
Requirement already satisfied: pip in /usr/lib/python3.8/site-packages (21.1.1)
[91mWARNING: Running pip as root will break packages and permissions. You should install packages reliably by using venv: https://pip.pypa.io/warnings/venv
[0mRemoving intermediate container c95be8e15e61
 ---> f6b211225136
Step 9/27 : RUN pip3 install --no-cache --upgrade pip setuptools
 ---> Running in 57a6dc8e84df
Requirement already satisfied: pip in /usr/lib/python3.8/site-packages (21.1.1)
Collecting pip
  Downloading pip-22.2.1-py3-none-any.whl (2.0 MB)
Requirement already satisfied: setuptools in /usr/lib/python3.8/site-packages (56.0.0)
Collecting setuptools
  Downloading setuptools-63.2.0-py3-none-any.whl (1.2 MB)
Installing collected packages: setuptools, pip
  Attempting uninstall: setuptools
    Found existing installation: setuptools 56.0.0
    Uninstalling setuptools-56.0.0:
      Successfully uninstalled setuptools-56.0.0
  Attempting uninstall: pip
    Found existing installation: pip 21.1.1
    Uninstalling pip-21.1.1:
      Successfully uninstalled pip-21.1.1
Successfully installed pip-22.2.1 setuptools-63.2.0
[91mWARNING: Running pip as root will break packages and permissions. You should install packages reliably by using venv: https://pip.pypa.io/warnings/venv
[0mRemoving intermediate container 57a6dc8e84df
 ---> 8a2a969cd203
Step 10/27 : RUN pip3 install --no-cache-dir pytest-testinfra
 ---> Running in c9bd18070e4c
Collecting pytest-testinfra
  Downloading pytest_testinfra-6.8.0-py3-none-any.whl (72 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 72.5/72.5 kB 12.8 MB/s eta 0:00:00
Collecting pytest!=3.0.2
  Downloading pytest-7.1.2-py3-none-any.whl (297 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 297.0/297.0 kB 35.0 MB/s eta 0:00:00
Collecting pluggy<2.0,>=0.12
  Downloading pluggy-1.0.0-py2.py3-none-any.whl (13 kB)
Collecting iniconfig
  Downloading iniconfig-1.1.1-py2.py3-none-any.whl (5.0 kB)
Collecting py>=1.8.2
  Downloading py-1.11.0-py2.py3-none-any.whl (98 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 98.7/98.7 kB 59.4 MB/s eta 0:00:00
Collecting tomli>=1.0.0
  Downloading tomli-2.0.1-py3-none-any.whl (12 kB)
Collecting attrs>=19.2.0
  Downloading attrs-21.4.0-py2.py3-none-any.whl (60 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 60.6/60.6 kB 48.3 MB/s eta 0:00:00
Collecting packaging
  Downloading packaging-21.3-py3-none-any.whl (40 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 40.8/40.8 kB 67.4 MB/s eta 0:00:00
Collecting pyparsing!=3.0.5,>=2.0.2
  Downloading pyparsing-3.0.9-py3-none-any.whl (98 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 98.3/98.3 kB 61.9 MB/s eta 0:00:00
Installing collected packages: iniconfig, tomli, pyparsing, py, pluggy, attrs, packaging, pytest, pytest-testinfra
Successfully installed attrs-21.4.0 iniconfig-1.1.1 packaging-21.3 pluggy-1.0.0 py-1.11.0 pyparsing-3.0.9 pytest-7.1.2 pytest-testinfra-6.8.0 tomli-2.0.1
[91mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
[0mRemoving intermediate container c9bd18070e4c
 ---> 543273af093e
Step 11/27 : RUN ln -s /usr/bin/php7 /usr/bin/php
 ---> Running in b54e1bab88d7
Removing intermediate container b54e1bab88d7
 ---> 76cb0b04836e
Step 12/27 : COPY config/nginx.conf /etc/nginx/nginx.conf
 ---> 1420549233c8
Step 13/27 : RUN rm /etc/nginx/conf.d/default.conf
 ---> Running in be2351317139
Removing intermediate container be2351317139
 ---> 147a44851d43
Step 14/27 : COPY config/fpm-pool.conf /etc/php7/php-fpm.d/www.conf
 ---> 77e747a69200
Step 15/27 : COPY config/php.ini /etc/php7/conf.d/custom.ini
 ---> 876c8d2f3c5a
Step 16/27 : COPY config/supervisord.conf /etc/supervisor/conf.d/supervisord.conf
 ---> eedf3b8aabba
Step 17/27 : RUN mkdir -p /var/www/html
 ---> Running in 799357efed9d
Removing intermediate container 799357efed9d
 ---> 102bec44ebe3
Step 18/27 : RUN mkdir -p /etc/nginx/test
 ---> Running in 3f1d22c6cd6c
Removing intermediate container 3f1d22c6cd6c
 ---> 4f11aafa02c3
Step 19/27 : COPY test/test.py /etc/nginx/test
 ---> 0e21cdc4f063
Step 20/27 : RUN chown -R nobody.nobody /var/www/html &&   chown -R nobody.nobody /run &&   chown -R nobody.nobody /var/lib/nginx &&   chown -R nobody.nobody /var/log/nginx
 ---> Running in 692bb9c87839
Removing intermediate container 692bb9c87839
 ---> e5e18ca05228
Step 21/27 : USER nobody
 ---> Running in e88c57e307f1
Removing intermediate container e88c57e307f1
 ---> 64de79a4139f
Step 22/27 : WORKDIR /var/www/html
 ---> Running in 734f1a0fa05e
Removing intermediate container 734f1a0fa05e
 ---> cf444fd41c4d
Step 23/27 : COPY --chown=nobody src/ /var/www/html/
 ---> cde08ac3ce9e
Step 24/27 : EXPOSE 8080
 ---> Running in 35ad7f8732c2
Removing intermediate container 35ad7f8732c2
 ---> 045e4109e46a
Step 25/27 : CMD ["/usr/bin/supervisord", "-c", "/etc/supervisor/conf.d/supervisord.conf"]
 ---> Running in cb584a08845e
Removing intermediate container cb584a08845e
 ---> 25753d9be6d4
Step 26/27 : HEALTHCHECK --timeout=10s CMD curl --silent --fail http://127.0.0.1:8080/fpm-ping
 ---> Running in 3a1a93341224
Removing intermediate container 3a1a93341224
 ---> 7c25ae40d376
Step 27/27 : RUN pytest /etc/nginx/test/test.py -p no:cacheprovider
 ---> Running in e94c3287c97e
============================= test session starts ==============================
platform linux -- Python 3.8.10, pytest-7.1.2, pluggy-1.0.0
rootdir: /etc/nginx/test
plugins: testinfra-6.8.0
collected 2 items

../../../etc/nginx/test/test.py ..                                       [100%]

============================== 2 passed in 0.14s ===============================
Removing intermediate container e94c3287c97e
 ---> 5df1b5e69da3
Successfully built 5df1b5e69da3
Successfully tagged skillbox:skillbox
